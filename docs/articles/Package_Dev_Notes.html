<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Package Development Notes • pathwayPCA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Package Development Notes">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pathwayPCA</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    User Guides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/C1-Quickstart_Guide.html">Chapter 1 - Quickstart Guide</a>
    </li>
    <li>
      <a href="../articles/C2-Importing_Data.html">Chapter 2 - Import and Tidy Data</a>
    </li>
    <li>
      <a href="../articles/C3-Create_Omics_Objects.html">Chapter 3 - Creating Data Objects</a>
    </li>
    <li>
      <a href="../articles/C4-Methods_Walkthrough.html">Chapter 4 - Test Pathway Significance</a>
    </li>
    <li>
      <a href="../articles/Package_Dev_Notes.html">Package Development Notes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Version Logs</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gabrielodom/pathwayPCA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Package Development Notes</h1>
                        <h4 class="author">Gabriel J. Odom, PhD, ThD</h4>
            
            <h4 class="date">2018-04-18</h4>
      
      <small>Source: <a href="https://github.com/gabrielodom/pathwayPCA/blob/master/vignettes/Package_Dev_Notes.Rmd"><code>vignettes/Package_Dev_Notes.Rmd</code></a></small>
      <div class="hidden name"><code>Package_Dev_Notes.Rmd</code></div>

    </div>

    
    
<p>Initial Date: 2017-10-19</p>
<p><br></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<hr>
<p>We aim to write a package to collect, organize, and document a suite of existing <code>R</code> scripts and files. The purpose of this is to ensure that biologists and bioinformaticians will be easily able to apply our work to their existing data. After a discussion with Prof. Chen, we will not include any support for prediction; this package will address pathway to response attribution only. Our core values for this project are as follows:</p>
<ul>
<li>Rely on as few external packages as possbile. This will require more development work at the beginning, but it will make future development, bug fixes, patches, and enhancements much easier.</li>
<li>Document <em>everything</em>. Once again, this will require more up-front work, but it will yield more informed end-users and make transitioning between development teams seamless.</li>
<li>Simplify. We want object names to have structure and files to be organized. This is more for future developers, but we expect this will help us as well.</li>
</ul>
<p>To see the current work on the project, please visit <a href="https://github.com/gabrielodom/pathwayPCA">our package development site</a> on GitHub, and <a href="https://gabrielodom.github.io/pathwayPCA/">our package website</a>. We can build the PDF manual via</p>
<pre><code>path &lt;- find.package("pathwayPCA")
system(paste(shQuote(file.path(R.home("bin"), "R")),
    "CMD", "Rd2pdf", shQuote(path)))</code></pre>
<div id="a-vocabulary-primer" class="section level3">
<h3 class="hasAnchor">
<a href="#a-vocabulary-primer" class="anchor"></a>A Vocabulary Primer</h3>
<p>For a tutorial on genomics, proteomics, lipidomics, and metabolomics, collectively known as “-omics” or “MS-omics” (mass spectrometry), from a computer scientist’s persepctive, see <a href="https://doi.org/10.1186/1471-2105-15-S7-S9">this BMC Bioinformatics paper</a>.</p>
<ul>
<li>Proteomics: the study of biological processes via the analysis of protein expression or state in cells or tissue. Proteins are built on peptides, which are amino acid chains constructed by mRNA translation.</li>
<li>Lipidomics: the systems-level study of lipids and their interactions. Lipids are often clustered into <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3995129/">eight categories</a> sharing certain chemical or physical properties: fatty acyls, glycerolipids, glycerophospholipids, sphingolipids, saccharolipids, polyketides, sterol lipids, and prenol lipids. According to <a href="https://www.crcpress.com/Functional-Lipidomics/Feng-Prestwich/p/book/9781574444674">Feng and Prestwich (2005)</a>, lipids that occur rarely or in small quantities are often the most effectual lipids in biological processes, meaning they are particularly important in disease diagnostics and in understanding pathology.</li>
<li>Metabolomics: the study of small molecular end products (called metabolomes) from cellular regulatory pathways.</li>
<li>Gemomics: the study of the complete set of DNA within a single cell of a living organism. As of 2013, this field of study was far and away the largest and best developed field of study of all the -omics branches.</li>
</ul>
<hr>
<p><br></p>
</div>
</div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The <code>pathwayPCA</code> package exists to extract principal components (PCs) from pre-defined gene or protein sets (called pathways) expressed in the users’ data. As shown in <a href="https://academic.oup.com/bioinformatics/article/24/21/2474/191290">Chen et al (2008)</a>, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3480088/">Chen et al (2010)</a>, and <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3215429/">Chen (2011)</a>, modelling outcomes based on PCs extracted from pathways yields superior results to modelling outcomes on all genes. This package will enable users to extract pathway PCs for outcome association or prediction via three principal component analysis (PCA) modifications</p>
<ol style="list-style-type: decimal">
<li>Vanilla PCA (<a href="http://stat.smmu.edu.cn/history/pearson1901.pdf">Pearson, 1901</a>)</li>
<li>Adaptive, Elastic-Net, Sparse PCA (<a href="http://www.it.dtu.dk/projects/manifold/Papers/sparsepc.pdf">Zou et al, 2006</a>; <a href="https://projecteuclid.org/euclid.aos/1245332831">Zou and Zhang, 2009</a>; and <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3215429/">Chen, 2011</a>)</li>
<li>Supervised PCA (<a href="http://amstat.tandfonline.com/doi/abs/10.1198/016214505000000628#.Wej7y1tSxhE">Bair et al, 2006</a>; <a href="https://academic.oup.com/bioinformatics/article/24/21/2474/191290">Chen et al, 2008</a>; and <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3480088/">Chen et al, 2010</a>)</li>
</ol>
<hr>
<p><br></p>
</div>
<div id="user-supplied-inputs" class="section level2">
<h2 class="hasAnchor">
<a href="#user-supplied-inputs" class="anchor"></a>User Supplied Inputs</h2>
<p>We expect the end-user to input the following information:</p>
<div id="gene-protein-input-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#gene-protein-input-matrix" class="anchor"></a>Gene / Protein Input Matrix</h3>
<p>We require an input matrix, <span class="math inline">\(\textbf{X}\)</span>. This data frame or matrix is expected to be in <a href="https://www.jstatsoft.org/article/view/v059i10">tidy form</a>: <span class="math inline">\(\textbf{X}\)</span> has <span class="math inline">\(n\)</span> rows, one for each observation, and <span class="math inline">\(p\)</span> columns, one for each gene or protein measured. Moreover, because the point of this package is to extract PCs from pathways, we need to know the names of the genes or proteins. Therefore, <span class="math inline">\(\textbf{x}\)</span> must include the names of the genes or proteins as column names.</p>
<p>For data input into an <code>R</code> environment, we recommend the end-user consider the <a href="https://cran.r-project.org/web/packages/readr/readr.pdf"><code>readr::</code></a>, <a href="https://cran.r-project.org/web/packages/readxl/readxl.pdf"><code>readxl::</code></a> (both part of the <a href="https://www.tidyverse.org/">Tidyverse</a>) and <a href="https://cran.r-project.org/web/packages/data.table/data.table.pdf"><code>data.table::</code></a> packages. See this <a href="https://csgillespie.github.io/efficientR/5-3-importing-data.html#fast-data-reading">white paper</a> for a comparison of speed and robustness of these packages. See this <a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly">Stack Overflow discussion</a> for comments on the strengths and weaknesses of the <code>data.table::</code> and Tidyverse packages. An anecdotal comparison could be that SQL users prefer <code>data.table::</code>, while most other users find the Tidyverse syntax easier to learn.</p>
</div>
<div id="response-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#response-matrix" class="anchor"></a>Response Matrix</h3>
<p>We request a response matrix, <span class="math inline">\(\textbf{Y}\)</span>. This data frame or matrix should have one column if the analysis expected is regression or classification and two columns (event time and censoring indicator) for survival. If <span class="math inline">\(\textbf{Y}\)</span> is <code>NULL</code>, then we assume that the end user requests PCs extracted from the pathways without any analysis or attribution ranking. We further require that the row order of the response matrix matches the row order of the gene / protein matrix.</p>
</div>
<div id="gene-set-list" class="section level3">
<h3 class="hasAnchor">
<a href="#gene-set-list" class="anchor"></a>Gene Set List</h3>
<p>We require a list of pathway information. This list must be composed of the following three elements</p>
<ol style="list-style-type: decimal">
<li>
<p><code>pathways</code>: a list of the hundreds or thousands of pathways in the gene set. Each element of the list will be a character vector containing the names of the genes or proteins. For example, a list entry could be</p>
<pre><code>"ALDH1B1" "ALDH2" "UGDH" "ALDH9A1" "ALDH3A2" "ALDH7A1" "UGT2B10" "UGT2A3" "UGT2B15"</code></pre>
<p>which is the name of nine genes in a particular pathway as a character vector.</p>
</li>
<li><p><code>TERMS</code>: a character vector of the names of the list elements in <code>pathways</code>. For example, the name of the pathway considered in the previous example is <code>KEGG_ASCORBATE_AND_ALDARATE_METABOLISM</code>.</p></li>
<li><p><code>setsize</code>: a named integer vector of the number of genes or proteins in each pathway. For example, the entry for the <code>KEGG_ASCORBATE_AND_ALDARATE_METABOLISM</code> pathway is 9.</p></li>
</ol>
<p>While we encourage the end-users to supply a pathway, this argument will default to either the “GO” or “MSigDB” pathways. This default gene set is a topic of further discussion. In future versions of this package, we will attempt to have these pathways automatically update from a web source as the package is loaded or attached via the <code>.onLoad()</code> or <code>.onAttach()</code> namespace hooks, respectively.</p>
</div>
<div id="additional-developer-arguments" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-developer-arguments" class="anchor"></a>Additional Developer Arguments</h3>
<p>We allow additional arguments to be passed to internal function calls via <code>...</code> (“dots”) functionality. These additional arguments are available to developers and data scientists who have the requisite knowledge of this package’s internal function design to make modifications to internal function defaults. We do not expect the common end-user to have any need for this.</p>
<p>One exception would be the choice of PCA variant. While I strongly believe this should be hidden or defaulted (at minimum, it should appear after the <code>...</code> in the arguments list, preculding any partial match possibilities), it should <em>at least</em> be addressed in the user-facing help documentation.</p>
<hr>
<p><br></p>
</div>
</div>
<div id="main-functions-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#main-functions-outputs" class="anchor"></a>Main Function(s) Outputs</h2>
<p>Our aim in this package is for the end-user to have little knowledge of this code or <code>R</code>’s inner workings and still be able to analyze his/her data.</p>
<div id="a-new-class-for-returned-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#a-new-class-for-returned-objects" class="anchor"></a>A New Class for Returned Objects</h3>
<p>With user ease in mind, we plan to have our user-facing functions return objects of a specific class, say <code>pathwayPCA_object</code> for instance. [To keep with our core value of simplicity, this class name choice obviously needs some work.] We will then develop methods for common functions which apply to objects of our class via the <code>UseMethod()</code> function. For example, we may want to return a model summary from a function output, so we will create a method for the common <code>summary()</code> function in <code>base::</code> <code>R</code>. This ensures that end-users can call functions to which they are already comfortable, such as <code>plot()</code>, <code>print()</code>, <code>table()</code>, and others, while we already prescribe the behavior of these functions when called on objects of our class.</p>
</div>
<div id="summary-graphics" class="section level3">
<h3 class="hasAnchor">
<a href="#summary-graphics" class="anchor"></a>Summary Graphics</h3>
<p>We will create plotting functions that produce annotated horizontal bar charts showing the significant pathways related to the response vector. The vertical axis will be specific pathways ranked by their negative log adjusted <span class="math inline">\(p\)</span>-values, and the horizontal axis will be these <span class="math inline">\(p\)</span>-values. We will annotate the bars themselves with summary statistics concerning the number of genes in that pathway.</p>
<p>The above graphics can be created irrespective of the type of response. However, we will also have a response-specific suite of graphics. This is a topic of further discussion.</p>
</div>
<div id="summary-tables" class="section level3">
<h3 class="hasAnchor">
<a href="#summary-tables" class="anchor"></a>Summary Tables</h3>
<p>Because of the flexibility of the <code>UseMethod()</code> function, we can return a single object that is handled differently by the <code>plot()</code> and <code>print()</code> functions. One main benefit to this is that we can create extractor functions to print summary tables from the pathway analysis. This table would include information such as the pathway name, raw <span class="math inline">\(p\)</span>-value, adjusted <span class="math inline">\(p\)</span>-value, significance ranking, number of genes in the pathway, number of genes expressed in the data, and potentially many more measurements (including measurements of model-specific importance: <span class="math inline">\(p\)</span>-values of independence tests on the Schoenfeld residuals of a Cox Proportional Hazards model when <span class="math inline">\(\textbf{Y}\)</span> is a survival-type response).</p>
</div>
<div id="list-of-pc-matrices" class="section level3">
<h3 class="hasAnchor">
<a href="#list-of-pc-matrices" class="anchor"></a>List of PC Matrices</h3>
<p>We also plan to return pathway-specific extracted PCs, either as a named list or as a column-concatenated matrix. I think that the class object would contain all this information in it anyway, but we would have an extractor function to access this as a list or matrix.</p>
</div>
<div id="developer-specifics" class="section level3">
<h3 class="hasAnchor">
<a href="#developer-specifics" class="anchor"></a>Developer Specifics</h3>
<p>We can also return model calls, model return specifics, and a report on algorithm convergence. This information would not ever be seen by the common end-user, but it would be available to data scientists or developers interested in debugging or troubleshooting an analysis pipeline.</p>
<hr>
<p><br></p>
</div>
</div>
<div id="current-work" class="section level2">
<h2 class="hasAnchor">
<a href="#current-work" class="anchor"></a>Current Work</h2>
<p>This is where I’m picking up next. I plan to write an analysis pipeline based on the requirements listed above. My next steps are: draft outlines for each of the necessary external and internal functions, piece out the existing code into these outlines, modify the outline documentation and existing code to match, and workflow test.</p>
<div id="the-function-outline" class="section level3">
<h3 class="hasAnchor">
<a href="#the-function-outline" class="anchor"></a>The Function Outline</h3>
<p>This is where we will document the inputs and outputs of the internal and external functions. We will decide which functions will be internal later.</p>
<p>[SPOKE WITH JAMES] An aside: after some testing (see the <code>Testing_Passing_Function_as_Argument.R</code> file in the <code>inst/</code> folder), we can pass functions as an argument to another function. Therefore, our PC extraction and pathway testing functions can take in functions appropriate to their methods: <code>pca()</code> / <code>svd()</code>, <code>aes.pca()</code>, or <code>suprPCA()</code> for PC extraction and <code>lm()</code>, <code>glm()</code>, <code><a href="http://www.rdocumentation.org/packages/survival/topics/coxph">survival::coxph()</a></code> and <code><a href="http://www.rdocumentation.org/packages/nnet/topics/multinom">nnet::multinom()</a></code> for pathway testing. Because of this, we can integrate development modularity and add other PCA variants or interesting models later, and the existing code can remain unchanged.</p>
<p>[SPOKE WITH JAMES 2] On applying a model function to each PC matrix in a pathway list: we will generate a model summary within the list apply, then create model-specific extraction functions. For example, assume we have 1000 pathways, and assume we ran a linear model testing the association between <span class="math inline">\(\textbf{Y}\)</span> and each pathway. Then, we can create a linear model summary accessor function to extract and tabulate all the relavent information from the output of <code>summary(lm(y ~ x))</code>. Creating statistic-specific extraction functions can wait for the next version of the package.</p>
<p>Functions will be as follows:</p>
<ul>
<li>A function to create an input object: take in <span class="math inline">\(\textbf{X}\)</span>, <span class="math inline">\(\textbf{Y}\)</span>, and the geneset list. Perform necessary compatability checks. Return an S4 object with class called (for the sake of argument) <code>pathwayExpression</code>. This is the function that will issue errors and warnings of the data or geneset has the wrong form, including a warning for a <code>NULL</code> response matrix.</li>
<li>Split the <code>pathwayExpression</code> object into a list of matrices by pathway. Remove all the pathway list matrices with fewer than <span class="math inline">\(k = 3\)</span> columns. Return (silently?) a character vector of all the annihilated gene pathways (this should probably be accessible to developers). Honestly, this function should probably be called internally within the function that creates the <code>pathwayExpression</code> objects.</li>
<li>Extract PCs from each pathway matrix in the <code>pathwayExpression</code> object: take in the list of matrices, the number of PCs to extract (default to <span class="math inline">\(k = 3\)</span>), and the extraction method (possibly as a function? How did Ben do that with the <code>slidR</code> package? ). Return a named list of pathway PC matrices, each with <span class="math inline">\(k\)</span> columns and <span class="math inline">\(N\)</span> rows. This function will require the methods (PCA, AES-PCA, and Supervised PCA) functions to be written seperately and either called internally or passed as an argument. Passed as an argument allows us to write new PCA methods in the future, without rewriting this function. These functions should all support parallel / cluster computing arguments, as this will probably bottleneck the code.
<ul>
<li>Vanilla PCA extraction: take in a list of matrices and the number of PCs to extract (defaults to <span class="math inline">\(k = 3\)</span>). Return a list of matrices with <span class="math inline">\(k\)</span> columns as the first <span class="math inline">\(k\)</span> eigenvectors of the pathway matrix or pathway covariance matrix. NOTE: inspect the computational requirement for PC extraction when <span class="math inline">\(N &gt; path_p\)</span> and <span class="math inline">\(N &lt; path_p\)</span>. Some pathways may have more features than observations, which makes calculating and decomposing the covariance matrix inefficient. Also, for <span class="math inline">\(N &gt; path_p\)</span>, we still have to multiply the <span class="math inline">\(N \times path_p\)</span> pathway matrix by the <span class="math inline">\(p \times k\)</span> eigenvectors. Taking the SVD directly may be more efficient still, if <span class="math inline">\(N\)</span> isn’t too large.</li>
<li>AES-PCA extraction: same as above, but we also can take in tuning parameters? Check into this.</li>
<li>Supervised PCA: same as above, but check for additional necessary arguments to build in or default</li>
</ul>
</li>
<li>Test each pathway in the <code>pathwayExpression</code> object for significance with the response, <span class="math inline">\(\textbf{Y}\)</span>. This function should also probably parallelized as well (but I don’t think running 1500 <span class="math inline">\(N \times 3\)</span> linear models is nearly as expensive as running 1500 SVDs or AES-PCAs).
<ul>
<li>Inputs: the list of pathway-extracted PCs from the “extract PCs” function (above), the response vector or matrix <span class="math inline">\(\textbf{Y}\)</span>, and the model function to apply across the list of extracted PCs. Once again, this should support a functional, not character, input, so that we can add attribution models in the future. </li>
<li>Output: oh man, this is where things get crazy. Do we return a data frame with one row for each pathway? Do we return a list of model summaries and try to do <code>purrr::</code> list extraction after the fact? That would be more difficult, but it would allow us to return a lot more stuff than the hard-coded data frame return option. Maybe we return a list of summaries, but then write seperate extraction functions based on the model choice? That does make more sense I suppose… [TALK TO JAMES ABOUT THIS.] Ok, here’s what we’re going to do: we will return a list of model summaries as a <code>genesetSummary</code> object.</li>
</ul>
</li>
<li>Tabulate <code>genesetSummary</code> results: this will be a suite of functions (probably called via <code>UseMethod()</code>). Each function will take in a <code>genesetSummary</code> object and return a data frame of the pathway names, unadjusted model <span class="math inline">\(p\)</span>-values, the number of expressed measures in the pathway, the total number of measures in the pathway, and other model-specific statistics / measurements. We will have an internal function for each of the four model types (<code>lm()</code>, <code>glm()</code>, <code><a href="http://www.rdocumentation.org/packages/survival/topics/coxph">survival::coxph()</a></code> and <code><a href="http://www.rdocumentation.org/packages/nnet/topics/multinom">nnet::multinom()</a></code>).</li>
<li>Adjust <span class="math inline">\(p\)</span>-values and sort the results data frame: this will take in a data frame returned by the function above, adjust the model <span class="math inline">\(p\)</span>-values, sort the columns by the adjusted <span class="math inline">\(p\)</span>-values, and return the sorted data frame.</li>
<li>Graphics: take in a sorted table from above, and create the following graphics
<ul>
<li>Horizontal Bar Chart: <span class="math inline">\(x\)</span>-axis will be <span class="math inline">\(-\log(p_{adj})\)</span>, <span class="math inline">\(y\)</span>-axis will be the pathways with the smallest 20-30 adjusted <span class="math inline">\(p\)</span>-values with labels as the pathway names, the box colour will be the percentage of genes expressed out of genes included in the pathway; mark each horizontal bar with an <span class="math inline">\(a / b\)</span> fraction, where <span class="math inline">\(a\)</span> is the number of expressed genes / proteins / lipids in the pathway, and <span class="math inline">\(b\)</span> is the total number of genes / proteins / lipids in the pathway.</li>
<li>Some other graphs?</li>
</ul>
</li>
</ul>
<div id="notes-on-documentation" class="section level4">
<h4 class="hasAnchor">
<a href="#notes-on-documentation" class="anchor"></a>Notes on Documentation</h4>
<ul>
<li>If you document classes that extend another class or depend on another file, make sure to list those dependencies in the <code>@include</code> field of the file documentation. Multiple files are listed with space delimiter. This field then updated the <code>Collates:</code> field of the <code>DESCRIPTION</code> file.</li>
<li>When you add a dataset to your package via <code><a href="http://www.rdocumentation.org/packages/devtools/topics/use_data">devtools::use_data()</a></code>, the name of the object should match the name of the file in the data/ directory.</li>
<li>If you document multiple functions in one file, follow the template in <code>validClass_Omics.R</code>. Use the <code>@rdname</code> to link the multiple functions together (all with the same function name after the tag). Also use colons to seperate section headers from section bodies – a line break isn’t enough.</li>
</ul>
</div>
<div id="completed-and-documented-functions" class="section level4">
<h4 class="hasAnchor">
<a href="#completed-and-documented-functions" class="anchor"></a>Completed and Documented Functions</h4>
<ul>
<li>
<code>createClass_Omics.*</code>: class declarations</li>
<li>
<code>validClass_Omics.*()</code>: validity functions</li>
<li>
<code>create_Omics.*()</code>: generation functions for each class</li>
<li>
<code><a href="../reference/expressedOmes.html">expressedOmes()</a></code>: given a pathway list, extract the -ome names from the data matrix which are in this pathway list. Then extract the matching columns from the MS design matrix. For supervised PCA, the minimum number of genes per pathway (given by <code>trim</code>) should match the <code>min.features</code> argument in the <code><a href="../reference/pathway_tScores.html">pathway_tScores()</a></code> and <code><a href="../reference/pathway_tControl.html">pathway_tControl()</a></code> functions. Otherwise, you will get this error: <code>Error in quantile.default(abs(cur.tt), 1 - (min.features/p)) :    'probs' outside [0,1]</code>
</li>
<li>
<code><a href="../reference/extract_aesPCs.html">extract_aesPCs()</a></code>: given the list of pathway gene expression matrices, extract the AES-PCA principal components from each pathway. For supervised PCA, the minimum number of genes per pathway (given by <code>trim</code>) should match the <code>min.features</code> argument in the <code><a href="../reference/pathway_tScores.html">pathway_tScores()</a></code> and <code><a href="../reference/pathway_tControl.html">pathway_tControl()</a></code> functions. Otherwise, you will get this error: <code>Error in quantile.default(abs(cur.tt), 1 - (min.features/p)) :    'probs' outside [0,1]</code>
</li>
<li>
<code><a href="../reference/permTest_OmicsSurv.html">permTest_OmicsSurv()</a></code>: given the list of pathway PCs, fit each pathway PC matrix to a given survival response via the Cox Proportional Hazards model, and record the AIC of the true model. Then, permute the response some thousands of times, fit Cox PH models to each, and record the AICs of these permuted-response models. Compare the true model AIC to the permuted-response model AIC, and record the proportion of models for which the the AIC of the permuted-response model is less than the AIC of the true model. This proportion is the <span class="math inline">\(p\)</span>-value for the specific pathway. The <code><a href="../reference/permTest_OmicsSurv.html">permTest_OmicsSurv()</a></code> function returns a named vector of all pathway permuted <span class="math inline">\(p\)</span>-values.</li>
<li>
<code><a href="../reference/permTest_OmicsReg.html">permTest_OmicsReg()</a></code>: <del>IN PROGRESS</del> DONE.</li>
<li>
<code>permTest_OmicsClassif()</code>: <del>IN PROGRESS</del> DONE.</li>
<li>The <code><a href="../reference/aespca.html">aespca()</a></code> functions and utilities:
<ul>
<li>
<code><a href="../reference/matrixRoot.html">matrixRoot()</a></code>: in the <code>calculate_matrixRoot.R</code> file. Take the <span class="math inline">\(r^{th}\)</span> root of a matrix, for <span class="math inline">\(r &gt; 0\)</span>.</li>
<li>
<code><a href="../reference/normalize.html">normalize()</a></code>: in the <code>unknown_matrixNorm.R</code> file. I am still at a loss for what this function does, but it modifies the output of the <code><a href="../reference/lars.lsa.html">lars.lsa()</a></code> function.</li>
<li>
<code><a href="../reference/lars.lsa.html">lars.lsa()</a></code>: in the <code>calculate_LARS.R</code> file. Least Angle and LASSO Regression (modified from the <code>lars::</code> package.)</li>
<li>
<code><a href="../reference/aespca.html">aespca()</a></code>: in the <code>calculate_AESPCA.R</code> file. Perform adaptive, elastic-net PCA on a pathway design matrix.</li>
</ul>
</li>
<li>The Cox PH Supervised PCA functions (in the <code>superPC_CoxPH_model.R</code> file):
<ul>
<li>
<code><a href="../reference/coxTrain_fun.html">coxTrain_fun()</a></code>: Takes in data, a vector of response times, and a censor vector. Return a scaled score vector.</li>
<li>
<code>.coxscor()</code>: internal - returns score vectors</li>
<li>
<code>.coxvar()</code>: internal - returns variances</li>
<li>
<code>.coxstuff()</code>: internal</li>
<li>
<code><a href="../reference/mysvd.html">mysvd()</a></code>: Takes in “tall” -omics data matrix, and returns its centered SVD and centering vector.</li>
</ul>
</li>
<li>The Regression Supervised PCA function: <code><a href="../reference/olsTrain_fun.html">olsTrain_fun()</a></code>
</li>
<li>The Classification Supervised PCA function: <code><a href="../reference/glmTrain_fun.html">glmTrain_fun()</a></code>
</li>
<li>Supervised PCA Wrapper Functions:
<ul>
<li>
<code><a href="../reference/superpc.train.html">superpc.train()</a></code>: Train the supervised PCA model.</li>
<li>
<code><a href="../reference/superpc.st.html">superpc.st()</a></code>: Given a fit object returned by <code><a href="../reference/superpc.train.html">superpc.train()</a></code>, extract and test the PCs for significance.</li>
<li>
<code><a href="../reference/pathway_tScores.html">pathway_tScores()</a></code>: a wrapper function that allows the user to apply both the training and extract/test functions across a list of pathways. For survival data, no <code>NA</code>s are allowed.</li>
<li>
<code><a href="../reference/pathway_tScores.html">pathway_tScores()</a></code>: Find the pathway-specific Student’s-<span class="math inline">\(t\)</span>scores.</li>
<li>The <code>randomControlSample</code> functions: <code><a href="../reference/permuteSamps.html">sample_Survivalresp()</a></code>, <code><a href="../reference/permuteSamps.html">sample_Regresp()</a></code>, and <code><a href="../reference/permuteSamps.html">sample_Classifresp()</a></code>. These functions either take a parametric bootstrap sample or permuted sample of the response input. For survival data, the response input is a set of event time and censoring vectors, while the response vector is “as is” for regression and classification.</li>
<li>
<code><a href="../reference/pathway_tControl.html">pathway_tControl()</a></code>: Find the pathway-specific control for the Student’s-<span class="math inline">\(t\)</span> scores. This function calls the <code>randomControlSample</code> functions to find a comparative null-distribution Student’s-<span class="math inline">\(t\)</span> score for each pathway. For survival data, no <code>NA</code>s are allowed.</li>
<li>
<code><a href="../reference/weibullMix_optimParams.html">weibullMix_optimParams()</a></code>: Given control the <span class="math inline">\(t\)</span> scores and the number of parameters in each pathway, find the estimated parameter values that minimize the Weibull mixture log-likelihood function.</li>
<li>
<code><a href="../reference/pathway_pValues.html">pathway_pValues()</a></code>: Given a set of optimal Weibull mixture parameters and a vector of control <span class="math inline">\(t\)</span> scores, calculated the associated <span class="math inline">\(p\)</span>-values for each pathway. This function will also ajdust these <span class="math inline">\(p\)</span>-values for multiple comparisons if requested (FDR correction by the Benjamini &amp; Hochberg (1995) step-up FDR-controlling procedure is the default).</li>
<li>
<code><a href="../reference/adjustRaw_pVals.html">adjustRaw_pVals()</a></code>: The <span class="math inline">\(p\)</span>-value adjustment function. This is a direct copy of <code><a href="http://www.rdocumentation.org/packages/multtest/topics/mt.rawp2adjp">multtest::mt.rawp2adjp()</a></code> from Bioconductor. I ported it to our package because I was having some <code>devel</code> and <code>bioc-devel</code> build issues on Travis. Unfortunately, those problems persisted even after this port, but I think I’ll leave it in anyway (one less package dependency).</li>
</ul>
</li>
<li>Adjustment functions:
<ul>
<li>
<code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code>: this function is a nice wrapper around the <code><a href="../reference/adjustRaw_pVals.html">adjustRaw_pVals()</a></code> function that allows us to simply take in a named vector as returned by the <code><a href="../reference/permTest_OmicsSurv.html">permTest_OmicsSurv()</a></code>, <code><a href="../reference/permTest_OmicsReg.html">permTest_OmicsReg()</a></code>, or <code><a href="../reference/permTest_OmicsCateg.html">permTest_OmicsCateg()</a></code> functions (for Supervised PCA) or as returned by the <code><a href="../reference/permTest_OmicsCateg.html">permTest_OmicsCateg()</a></code> function (for AES-PCA).</li>
<li>
<code>superPCA_pathway_pvals()</code>: <del>BUILT BUT NOT YET DOCUMENTED. Currently, this function is still in <code>Test_supervisedPCA_wrapper.R</code>.</del> This is completed, and in the file <code>superPC_wrapper.R</code>.</li>
</ul>
</li>
</ul>
</div>
<div id="functions-still-to-build" class="section level4">
<h4 class="hasAnchor">
<a href="#functions-still-to-build" class="anchor"></a>Functions Still to Build</h4>
<p>These are functions called in functions I have built so far, but I have yet to build them. I still need to find an example for regression data and logistic data to test these functions to find out what I’m missing.</p>
<ul>
<li>The additions to <code><a href="../reference/glmTrain_fun.html">glmTrain_fun()</a></code>, <code><a href="../reference/superpc.train.html">superpc.train()</a></code>, and <code><a href="../reference/superpc.st.html">superpc.st()</a></code> for n-ary and ordered responses. Currently I have a <code>stop()</code> command for these two.</li>
<li>Export the second <code>calculate_pathway_pvalues()</code> function (the one with the <code>if()</code> statements and error checks) from the <code>Test_supervisedPCA_wrapper.R</code> file to a proper function file in <code>R/</code>. NOTE: This function should call the <code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code> function, rather than have that code defined internally (or maybe have the sorting as an external last step?). Ok, so actually export the third version: <code>superPCA_pathway_pvals()</code>. This function calls the <code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code> function. DONE.</li>
<li>Graphs: check out the link between <code>Cytoscape</code> and <code>R</code>. Apparently the <code>Cytoscape</code> grapics are nice.</li>
</ul>
</div>
</div>
<div id="piecing-in-existing-code" class="section level3">
<h3 class="hasAnchor">
<a href="#piecing-in-existing-code" class="anchor"></a>Piecing in Existing Code</h3>
<p>On 22 Feb, I met with James to discuss this progress. I still need to:</p>
<ol style="list-style-type: decimal">
<li>Create a wrapper function for the AES-PCA workflow (similar to the wrapper for Supervised PCA). DONE: this function is in <code>aesPC_wrapper.R</code>.</li>
<li>Finish the Supervised PCA vignette. DONE.</li>
<li>Find out why <code>browseVignettes()</code> can’t find the vignette I’ve written. Because when you install a package from GitHub, it doesn’t automatically build the vignette. Building vignettes can take a while. If you want this to happen, use <code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github("gabrielodom/pathwayPCA", build_vignettes = TRUE)</a></code>.</li>
<li>Write the AES-PCA vignette. DONE.</li>
<li>Curate a small, example data set and gene pathway set for our examples and vignettes. DONE</li>
</ol>
<p>Also after that meeting, I renamed many files to fit my <code>superPC</code>, <code>aesPC</code>, and <code>createClass</code> file groups.</p>
</div>
<div id="still-to-do" class="section level3">
<h3 class="hasAnchor">
<a href="#still-to-do" class="anchor"></a>Still to Do</h3>
<ol style="list-style-type: decimal">
<li>Check the “Functions Still to Build” section: specifically, we have graphics functions to build and we need to add functionality for more GLM variants.</li>
<li>
<p>Examples for all the main functions. Completed functions are</p>
<ol style="list-style-type: lower-alpha">
<li>The <code>create_Omics*()</code> functions. There is a working example for each.</li>
<li><code><a href="../reference/superPCA_pVals.html">superPCA_pVals()</a></code></li>
<li><code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code></li>
<li><code><a href="../reference/topGenes.html">topGenes()</a></code></li>
<li><code><a href="../reference/expressedOmes.html">expressedOmes()</a></code></li>
</ol>
</li>
</ol>
<p><del>I still need to add “do not touch” examples to the other exported functions. The end user should know that these functions are being called, and how the functions work in detail (should they desire), but should not be encouraged to call them directly.</del> DONE.</p>
<ol start="3" style="list-style-type: decimal">
<li>
<del>Replace all <code>\$ stuff \$</code> with <code>\eqn\{ stuff \}</code> in the R documentation files.</del> DONE.</li>
<li>Finish documentation for
<ol style="list-style-type: lower-alpha">
<li>
<del><code><a href="../reference/aespca.html">aespca()</a></code></del> DONE.</li>
<li>
<del><code><a href="../reference/normalize.html">normalize()</a></code></del> DONE.</li>
</ol>
</li>
<li>Add an option to <code><a href="../reference/extract_aesPCs.html">extract_aesPCs()</a></code> to ask the <code><a href="../reference/aespca.html">aespca()</a></code> function to return the <code>oldscore</code> matrix instead of the <code>score</code> matrix. This is all we need to add vanilla PCA to the package. Of course, we’ll also have to document this as well, but w/e.</li>
</ol>
<hr>
<p><br><br></p>
</div>
</div>
<div id="testing" class="section level1">
<h1 class="hasAnchor">
<a href="#testing" class="anchor"></a>Testing</h1>
<p>James sent me comments as a Word file. I am adding these comments to the file <code>James_Tests_20180228.Rmd</code> in the <code>testing_files/</code> directory. I will repeat each of his errors / comments here <span style="color:blue"> in blue </span>, and my fixes / responses below them.</p>
<div id="installing-package-error" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-package-error" class="anchor"></a>Installing Package Error</h2>
<p>When James installs the package using <code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github("gabrielodom/pathwayPCA", build_vignettes = TRUE)</a></code>, <span style="color:blue"> he sees the following error: </span></p>
<pre><code>Error: processing vignette 'AES-PCA_Walkthrough.Rmd' failed with diagnostics:
there is no package called 'tidyverse'</code></pre>
<p>This error is due to the package <code>tidyverse</code> being unavailable on his machine. There are three workarounds, as described in <a href="https://github.com/lme4/lme4/issues/233">this GitHub thread</a>:</p>
<ol style="list-style-type: decimal">
<li>Do not build the vignettes: <code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github("gabrielodom/pathwayPCA", build_vignettes = FALSE)</a></code>
</li>
<li>
<p>Install the dependencies of the vignettes first, then install the package</p>
<pre><code>install.packages(c("tidyverse", "reshape2"))
devtools::install_github("gabrielodom/pathwayPCA", build_vignettes = TRUE)</code></pre>
</li>
<li>
<p>Install the dependencies in the function call:</p>
<pre><code>devtools::install_github("gabrielodom/pathwayPCA",
                     build_vignettes = TRUE,
                     dependencies = TRUE)</code></pre>
</li>
</ol>
<p>While I do not believe with absolute certainty that all three methods will work, I do believe that <em>at least one</em> of the three methods will work.</p>
<hr>
<p><br></p>
</div>
<div id="data-format-and-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#data-format-and-structure" class="anchor"></a>Data Format and Structure:</h2>
<div id="input" class="section level3">
<h3 class="hasAnchor">
<a href="#input" class="anchor"></a>Input</h3>
<p><span style="color:blue"> I think the user input data should be a more general format, e.g. vector, list, data frame, matrix. </span></p>
<ol style="list-style-type: decimal">
<li><span style="color:blue"> less people are familiar with tidy form: can it be data frame or list for input if it would not give us any data cleaning, converting, or computing efficiency issue later in the analysis? Internally use “tibble” to pass data </span></li>
<li><span style="color:blue"> can we convert the following input formats internally and provide the message such as “numeric values are coerced to factor…” </span></li>
</ol>
<p>I strongly disagree with automatic data wrangling. There is really no way to know that the data we would use to create an <code>Omics*</code> object is what the user intended without the user confirming the data creation. At the most crucial juncture of the data analysis, we should force the user to check that their inputs are <em>exactly</em> what they intend. Once again, the “garbage in, garbage out” rule applies heavily. To this end, I have added a <em>very</em> verbose error for the <code>massSpec</code> object input as a matrix. This would be the most common error we expect to see, so we explain our input class philosophy in this error message, as well as point the user to the appropriate help file (from the error itself). Within the help file, I’ve added the “Details” section to explain <em>why</em> we care so strongly about the classes of the inputs.</p>
<p>However, I do believe that the creation and inclusion of a <em>data wrangling</em> vignette would most likely be beneficial to the average user. Furthermore, we can edit the error messages in the <code>Omics*</code> object creation to include a link to the help files, and even some pointers on common problems in the data creation step. Because the data structure of the <code>Omics*</code> objects are so crucial to the proper execution of the remainder of the analysis, I should beef up the errors, warnings, and messages at this step.</p>
</div>
<div id="gene-set-list-1" class="section level3">
<h3 class="hasAnchor">
<a href="#gene-set-list-1" class="anchor"></a>Gene Set List</h3>
<p><span style="color:blue"> Do we need “setsize” at all for input? I think we can calculate this one, and return this plus the ratio of number of available assayed features/genes to input gene set. </span></p>
<p>This is correct. We do not need the user to supply the <code>setsize</code> object. We can request a list of the gene pathways and a vector of the pathway names (if more detail is necessary than the list names – GOXXXXXX vs “Kegg glycolosis etc pathway”). If the <code>TERMS</code> element of the pathway list is <code>NULL</code>, then we will copy the list names to the <code>TERMS</code> entry. Further, we will calculate the number of genes in each pathway at the outset of analysis, and store this number as a (named?) vector element of the pathway list called <code>setsize</code>.</p>
<p>TO DO: <del>the above. Also, finish the documentation in the <code>Omics*_class</code> and <code>create_Omics*</code> function files. They currently have no information on the restrictions of the <code>pathwaySet</code> object.</del> DONE: also, I’ve added hyperlinks between all the S4 classes documentation and the creation functions for the S4 objects. Also, I’ve removed the <code>setsize</code> element from the <code>colonGenesets_ls</code> list. All of the documentation is updated to reflect the fact that the <code>setsize</code> element of the pathway set list is calculated at object generation. NOTE: the <code>setsize</code> object we create within <code>Omics*</code> object creation must be a named vector. Also, in the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function, I am adding a revised <code>setsize</code> object to reflect the number of genes in each pathway after trimming.</p>
</div>
<div id="output" class="section level3">
<h3 class="hasAnchor">
<a href="#output" class="anchor"></a>Output</h3>
<ol style="list-style-type: decimal">
<li>
<span style="color:blue"> Do we allow return model as an option? or can we optionally return model estimates when using superPCA_pVals? </span> NEED CLARIFICATION: I was under the impression that this package would be used for attribution only. If this is the case, the model should not be returned, because it is irrelevant.</li>
<li>
<span style="color:blue"> Should we include a local fdr (q value) as an option? </span> I’m assuming you mean to add this option in the <code>ajustment</code> argument to the <code><a href="../reference/superPCA_pVals.html">superPCA_pVals()</a></code> and <code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code> functions? If so, it’s a simple fix: we add the method and it’s name to the <code><a href="../reference/adjustRaw_pVals.html">adjustRaw_pVals()</a></code> function (in the <code>calculate_multtest_pvalues.R</code> file). All I would need is either the code for the specific LDFR method you want, or a paper wherein the method is descibed in detail.</li>
</ol>
</div>
</div>
<div id="functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#functionality" class="anchor"></a>Functionality:</h2>
<div id="create_omicssurv" class="section level3">
<h3 class="hasAnchor">
<a href="#create_omicssurv" class="anchor"></a><code><a href="../reference/create_OmicsPathway.html">create_OmicsSurv()</a></code>
</h3>
<ol style="list-style-type: decimal">
<li>
<p><span style="color:blue"> can we return data validity summary, for example, </span></p>
<ol style="list-style-type: lower-alpha">
<li><span style="color:blue"> percent matched features between measured genes and genes in the pathways, </span></li>
<li><span style="color:blue"> number/percent of pathways would be disregarded/analyzed, as in “missingPaths”? </span></li>
<li><span style="color:blue"> percent of deaths/lives for events, </span></li>
</ol>
</li>
</ol>
<p>I’m adding additional attributes to the output of the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function: the percent of columns in the <code>massSpec</code> data frame that are <em>not</em> mentioned in the pathways (<code>removedFeatures</code>) and the percent of genes mentioned in the pathways that are columns in the <code>massSpec</code> data frame (<code>expressedFeatures</code>). We are already reporting any pathways that are removed due to low raw expression, but adding the other atttributes will paint a clearer picture of the overlap between the pathway set and the provided data. I’m working to add this information as a column of the resulting sorted data frame. Access this information by calling the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function on your <code>Omics*</code> object, and viewing the attributes of the <code>pathwaySet$pathways</code> element.</p>
<p>For a, the percent of features removed from the <code>massSpec</code> data frame is in the <code>removedFeature%</code> attribute, while the percent of features in the pathway that have matching values is in the <code>selectedFeature%</code> attribute. These attributes are attached to the pathways in the <code>pathwaySet</code> element of the <code>Omics*</code> object returned by the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function. Further, the count of genes present for analysis in each pathway is returned in the <code>trim_size</code> column in the data frame returned by the <code>*_pVals()</code> functions. This column should be compared against the <code>setsize</code> column, which contains the original gene count for each pathway. For b, the pathways with 0 genes included in the <code>trim_size</code> column are the pathways that were removed from the analysis because they had fewer than <code>trim</code> genes (as supplied by the <code>min.features = 3</code> argument of the two <code>*_pVals()</code> functions). I also updated the vignettes to account for this new column in the output data frame. For c, the user supplies this information. I see no reason to return EDA information at the <em>end</em> of the pathway analysis. We can consider printing the summary information of created <code>Omics*</code> objects at creation (so that the end user sees a visual confirmation that their object was created correctly), but I’m unconvinced that we need to create specific functions for EDA, or return any summary information at the end of analysis.</p>
<p>I also added messages to the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function that print to the screen during function execution (not for the internal <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> call that only cares about returning the list of matrices, but the main call). I used a new argument called <code>messages</code>, which defaults to <code>TRUE</code>, to deal with this.</p>
<ol start="2" style="list-style-type: decimal">
<li><span style="color:blue"> can we change the name ‘massSpec’ to ‘assayData’ or something more general terms that include data generated from mass spectrum, gene expression, and other types of genomic data. </span></li>
</ol>
<p>Yes. I will replace all instances of <code>massSpec</code> and <code>massSpec_df</code> with <code>assayData_df</code>. I made this replacement in all five <code>createClass_*.R</code> files, <code>create_Omics_All.R</code>, <code>subsetExpressed-omes.R</code>, and <code>superPC_wrapper.R</code>. The documentation changes in these files will proliferate to the <code>man/</code> files. I’ve also replaced the arguments to the function calls in the two vignettes, and</p>
<ol start="3" style="list-style-type: decimal">
<li><span style="color:blue"> is it possible to simplify or hide the values of the return object that is printed on the screen? </span></li>
</ol>
<p>Yes. I’ve added the classes <code>tbl_df</code> and <code>tbl</code> to the ouptut data frame of the <code>*_pVals()</code> functions. If the end user has the suggested <code>tidyverse::</code> package suite loaded, then the data frame will print nicely to the screen as a <code>tibble</code> object. If not, the data frame will print to the screen as a normal data frame. This removes the need to create a new class for our data frame output, and we further avoid <em>depending</em> on the <code>tidyverse::</code>. However, creating a new class for our output data frame may be beneficial for the graphics components added in the next version of this package. At that time, it may be beneficial to create specific <code>print.CLASS()</code>, <code>plot.CLASS()</code>, and <code>summary.CLASS()</code> methods. At this juncture, however, this functionality seems superfluous.</p>
</div>
<div id="create_omicscateg" class="section level3">
<h3 class="hasAnchor">
<a href="#create_omicscateg" class="anchor"></a><code><a href="../reference/create_OmicsPathway.html">create_OmicsCateg()</a></code>
</h3>
<p><span style="color:blue"> should we change it to OmicsBinary since we only support binary response at the moment? <span></span></span></p>
<p>No. Function names should not change when functionality is <em>added</em>, only when it is <em>removed</em>. We do not want people to use this package and write their scripts to analyze data just to have those scripts break <em>on purpose</em> when we change the name of a function in the next version. We would have to flag the <code>create_OmicsBinary()</code> function for depreciation in version 2 while simultaneously adding the (very similar) <code><a href="../reference/create_OmicsPathway.html">create_OmicsCateg()</a></code> function, then depreciate the binary function in version 3. Instead, we leave it as one function, but add an error message explaining that we only support binary classification in this version. (this error message currently exists, but we could beef it up with a link to the package release notes?).</p>
<p><del>ERROR: I tested the AES-PCA workflow with a three-level factor as the response and the code executed without erroring. The Supervised PCA workflow hit my error message from the <code><a href="../reference/superpc.train.html">superpc.train()</a></code> function in <code>superPC_train.R</code> or the <code><a href="../reference/superpc.st.html">superpc.st()</a></code> function in <code>superPC_model_tStats.R</code>.</del> FIXED: I added an error to the <code><a href="../reference/valid_OmicsSurv.html">valid_OmicsCateg()</a></code> function within <code>createClass_validOmics.R</code>. Now we stop the end user from ever creating a valid <code>OmicsCateg</code> object with more than two levels of their factor.</p>
</div>
<div id="aespca_pvals" class="section level3">
<h3 class="hasAnchor">
<a href="#aespca_pvals" class="anchor"></a><code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code>
</h3>
<ol style="list-style-type: decimal">
<li><span style="color:blue"> can we add first k PCs option in the example? Or set it to k=2. </span></li>
</ol>
<p>This is governed by the <code>numPCs</code> argument in the <code>*_pVals()</code> functions. It defaults to 1. We can easily change the default to 2, or any number less than <code>min.features</code> (which defaults to 3). If you would like more than</p>
<ol start="2" style="list-style-type: decimal">
<li><span style="color:blue"> is it possible to add returning per gene score/association (association of PCs with features, we need to talk with Dr. Chen about this) </span></li>
</ol>
<p>To me, because this package is designed with pathway <em>attribution</em> in mind, specific gene scoring should not be the focus of the package functions. If necessary, we could add some basic feature attribution tests for the genes from the top X pathways, but these functions would necessarily have to preserve the FDR from the pathway calculation. An ad hoc method could be to simply return any genes that appear in more than one of the top X pathways. This would not require any “testing”, and it would not inflate the pathway FDR values.</p>
<p>I’ve created the <code><a href="../reference/topGenes.html">topGenes()</a></code> function to take in the output <span class="math inline">\(p\)</span>-value data frame from either <code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code> or <code><a href="../reference/superPCA_pVals.html">superPCA_pVals()</a></code> and a valid supervised <code>Omics*</code> object. I create a matrix with all pathways as the columns and all genes as the rows, with a 1 in the <span class="math inline">\(i, j\)</span> entry of the matrix if gene <span class="math inline">\(i\)</span> is an element of pathway <span class="math inline">\(j\)</span> (after trimming the pathways to the assay data frame suplied). Then I multiply each pathway membership indicator column by the negative natural logarithm of the <span class="math inline">\(p\)</span>-values for that pathway. This function then returns a named numeric vector of the gene sums of these scores, sorted in descending order. This function is built, tested, and documented. Furthermore, I’ve googled the relationship between the top 5% of genes and colon cancer, and almost all of them have published research papers dedicated to (or at minimum mentioning) their relationship with colon cancer. This was nice to see.</p>
<p><del>I need to add a <code><a href="../reference/topGenes.html">topGenes()</a></code> example to the two vignettes.</del> DONE.</p>
<ol start="3" style="list-style-type: decimal">
<li><span style="color:blue"> Also, in the return table should we add a column of number of available assayed features/genes in pathways </span></li>
</ol>
<p>That’s been handled through the <code>trim_size</code> column discussed above.</p>
</div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p><code>OmicsReg</code> — <span style="color:blue"> in terms of survival time vs features, should we use only events which occurred (death)? </span></p>
<p>If we were trying to perform some actual analysis, sure. We are not. We are simply showing how the functions work (specifically how to create a continuous-response <code>Omics</code> object). For this reason, we could have generated a random normal vector of length 250.</p>
</div>
<div id="graphics" class="section level2">
<h2 class="hasAnchor">
<a href="#graphics" class="anchor"></a>Graphics:</h2>
<p><span style="color:blue"> Consider a multiple-side-by-side plot: pathway size/core genes, pathway significance, up/down direction of association </span></p>
<p>Because we are testing attribution between response and extracted principal components intstead of the genes themselves, “upregulation” and “downregulation” do not make much sense to me. It’s possible that the first PC may be positively or negatively associated with an outcome, but the second PC may have a significant relationship of the opposite sign (because PCs are orthogonal, I’d expect this relationship more often than not). I’d prefer to present our work as a way to explore which pathways have a relationship with the outcome, as well as present the contents of these pathways, than attempting to describe the <em>type</em> of the relationship.</p>
</div>
<div id="computational-and-memory-issue" class="section level2">
<h2 class="hasAnchor">
<a href="#computational-and-memory-issue" class="anchor"></a>Computational and memory issue:</h2>
<p><span style="color:blue"> Check memory used during the computation, but I think it should not be any issue. </span></p>
<p>I will test the memory used when I test James’ test script / data, using the 8-core restriction that he has on his machine. At the most memory-expensive part of the AES-PCA workflow (extracting pathway PCs), the software used 1.7 Gb of memory over the baseline. During pathway <span class="math inline">\(p\)</span>-value calculation, 1.5 Gb of memory was used over baseline.</p>
</div>
<div id="report-of-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#report-of-errors" class="anchor"></a>Report of errors:</h2>
<div id="checking-data-validity" class="section level3">
<h3 class="hasAnchor">
<a href="#checking-data-validity" class="anchor"></a>Checking data validity</h3>
<p><span style="color:blue"> we probably need more meaningful error messages </span></p>
<p>I agree on this. However, we will need to work together to anticipate common errors, and then write helpful messages when those errors trigger. I have added a few, but I don’t even know how biologists think. I was hoping that the very detailed vignettes would help.</p>
</div>
<div id="pathway_tscores" class="section level3">
<h3 class="hasAnchor">
<a href="#pathway_tscores" class="anchor"></a><code><a href="../reference/pathway_tScores.html">pathway_tScores()</a></code>
</h3>
<p><span style="color:blue"> how do we deal with NA values? Is it allowed? Can we ignore NA value? Or provide a meaningful error message </span></p>
<p>I honestly just don’t know.</p>
</div>
</div>
<div id="vignettes" class="section level2">
<h2 class="hasAnchor">
<a href="#vignettes" class="anchor"></a>Vignettes:</h2>
<p><span style="color:blue"> In “Calculate Pathway-Specific Model”, it was read “use the Bonferroni and Sidak…” but in the code, it shows “Hoch” rather than “bonferroni” </span></p>
<p>FIXED.</p>
</div>
<div id="other-thoughts" class="section level2">
<h2 class="hasAnchor">
<a href="#other-thoughts" class="anchor"></a>Other thoughts:</h2>
<p><span style="color:blue"> Do we need a short paragraph to describe which method (aespca or superpca) to choose or compare the two methods? We can talk with Dr. Chen about this. </span></p>
</div>
<div id="testing-on-different-data-set" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-on-different-data-set" class="anchor"></a>Testing on different data set:</h2>
<p><span style="color:blue"> The below comments and code are from James verbatim. </span></p>
<blockquote>
<p>Input data: cp5.1.ls—500 pathways prot.voom.spca—150 rows X 6332 columns tumor.ind—vector of 150 binary values</p>
</blockquote>
<blockquote>
<p>Code and function I used:</p>
</blockquote>
<pre><code>create_OmicsCateg(prot.voom.spca, cp5.1.ls,  tumor.ind)
AESPCA_pVals

Error in data.frame(pathways = names(pVals_vec), setsize = genesets_ls$setsize,  : 
arguments imply differing number of rows: 0, 500, 476</code></pre>
<p>James transformed <code>prot.voom.spca</code> to a <code>tibble</code> object (which is unnecessary – updated the vignettes / documentation to explain that the data must be a <strong><code>data frame</code></strong>; it <em>can</em> be a <code>tibble</code>, but it doesn’t have to be). This is the code he sent me:</p>
<pre><code>require(tibble) # I dont find it preloaded with pathwayPCA, if we use this
                #   format we should probably add it as dependency
prot.voom.tbl = as_tibble(prot.voom.spca)
tumor_OmicsCateg &lt;- create_OmicsCateg(assayData_df = prot.voom.tbl,
                                      pathwaySet_ls = cp5.1.ls,
                                      response_fact = as.factor(tumor.ind))</code></pre>
<p>This all works fine. Calling <code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code> on this object errors:</p>
<blockquote>
<p>Part 1: Calculate Pathway AES-PCs Error in newPaths[[i]] : subscript out of bounds</p>
</blockquote>
<p>The traceback shows the error is in the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function, so I browsed into that.</p>
<ol style="list-style-type: decimal">
<li>The line <code>missingPaths_char &lt;- names(newPaths_trim)[nullPaths]</code> returned <code>NULL</code> when there were actually 18 missing paths. This is because I’m assuming that the <code>pathways</code> list in the <code>pathwaySet</code> list is named. I need to create some check for that at object creation. If the names are null, then we add <code>paste0(pathway, 1:P)</code> as the pathway names. This also caused the “missing paths” message to print 0 missing paths. I’ve added a check for <code>NULL</code> names in the <code>Omics*</code> creation functions.</li>
<li>For the AES-PCA workflow, we call <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> twice. The first time everything is fine (minus the names of the pathways), but the second time has an issue: we are initializing the <code>trimSetsize</code> vector as the original <code>setsize</code> vector, but these vectors aren’t the same length if a pathway has been removed. I really need to split this into two functions. <del>I should have <code>expressedOmes</code> call the function to return a list internally.</del> No, because the list version is only ever needed in the <code><a href="../reference/extract_aesPCs.html">extract_aesPCs()</a></code> function in the <code>aesPC_extract_OmicsPath_PCs.R</code> file, I removed the “list” option from the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function, and I’m creating the list of matrices internally to the <code><a href="../reference/extract_aesPCs.html">extract_aesPCs()</a></code> function. This seems to have solved the second problem.</li>
<li>After fixing these two errors, we have a problem in the <code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code> function call. Somehow, the 18 removed pathways were removed somewhere else. What happened was that the pathways with 0 genes were removed from calculation, but not from tabulation. <del>I’m going to add these genes back in (in the <code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code> function), but give them <code>NA</code> <span class="math inline">\(p\)</span>-values.</del> That won’t work, because we have no way of knowing which NAs belong with which pathways. During <code>Omics*</code> creation, I will add names to the <code>setsize</code> vector, <del>then pad the missing paths with NAs in the <code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code> function right before we call <code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code></del> (no, I’m going to pad the vector within the <code><a href="../reference/adjust_and_sort.html">adjust_and_sort()</a></code> function because both AES and Supervised need it). I’m already checking for names for the <code>pathways</code> list, so we can take the names checked / created at that step and attach them to the <code>TERMS</code> and <code>setsize</code> entries. NOTE: this assumes that <em>all</em> the pathways have names. I’m using an <code>is.null()</code> check, but I should probably use some check for an empty string too. I’ll talk to James about the best way to do this. Maybe hold the supplied names for later? I added checks to each creation function for <code>NULL</code> names and missing names; if you name some elements of a list but not others, the unamed elements are named <code>NA</code>. The problem now is that list objects do not require that their names be unique, so I’ll have to find a way to force unique names (a la data frames). I used the <code>lengths&lt;-</code> function to create a copy of the pathway list where each pathway had one gene only; then I turned this into a data frame to handle duplicate element names (at Alejandro M.’s suggestion); I then save the names of the pathway list as the names from this data frame (so that all the names are the same, but duplicate names end in <code>.1</code>, <code>.2</code>, etc.).</li>
<li>Test what will happen if we say <code>adjust = TRUE</code> and <code>adjustment = character(0)</code> (or just leave it missing)?</li>
<li>Most of the <span class="math inline">\(p\)</span>-values are 0, even after increasing the permutations to 5000.</li>
<li>
<del>The <code><a href="../reference/topGenes.html">topGenes()</a></code> function errors.</del> FIXED. If there are <code>NA</code> <span class="math inline">\(p\)</span>-values (from the trimmed pathways), the <code>which()</code> and <code>min()</code> functions errored. I added an <code>na.omit()</code> call to remove the rows from the <code>pVals_df</code> data frame corresponding to any trimmed pathways.</li>
</ol>
<p><del>I’ve changed core functionality to the creation function and the <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function. TO DO: document these updates in the help files.</del> DONE.</p>
<blockquote>
<p>using the function superPCA_pVals, I got similar error:</p>
</blockquote>
<pre><code>Error in data.frame(pathways = names(pVals_vec), setsize = genesets_ls$setsize,  : 
  arguments imply differing number of rows: 0, 500</code></pre>
<p>The function runs now, but with warnings at every pathway:</p>
<pre><code>In maxt_vec - bn_vec :
  longer object length is not a multiple of shorter object length
In maxt_vec + bn_vec :
  longer object length is not a multiple of shorter object length
In x - bn : longer object length is not a multiple of shorter object length
In x + bn : longer object length is not a multiple of shorter object length</code></pre>
<ol style="list-style-type: decimal">
<li>Searching through the package shows that these show up in the <code><a href="../reference/weibullMix_optimParams.html">weibullMix_optimParams()</a></code> function in the <code>superPC_optimWeibullParams.R</code> file. I suspect (because of my experience troubleshooting the AES-PCA wrapper) that the problem is when we call the <code><a href="../reference/weibullMix_optimParams.html">weibullMix_optimParams()</a></code> function and pass the <span class="math inline">\(p\)</span>-values vector (with some pathways trimmed) and the <code>setsize</code> vector (without pathways trimmed). These two vectors will not have the same length.</li>
<li>The <code><a href="../reference/superPCA_pVals.html">superPCA_pVals()</a></code> function in the <code>superPC_wrapper.R</code> file passes the untrimmed <code>setsize</code> vector to the Weibull parameter calculation.</li>
<li>For some data sets, the Supervised PCA <span class="math inline">\(p\)</span>-values are too small. James passed a data set where the response was a randomly ordered response from another data set. AES-PCA correctly identified it as noise, but Supervised PCA did not. Also, I dug into the <code>weibullMix_-_optimParams()</code> function and found that the <code>optim()</code> function is extremely sensitive to the initial values chosen. The constrained optimization routine works for <span class="math inline">\(\mu_1 = 1, \mu_2 = 1\)</span>, but not for many values outside the range from <span class="math inline">\([-1.5, 1]\)</span>. In fact, for negative values of these parameters, one optimum point is found, but a second poit is found for positive values. This leads me to believe that the density is bimodal. Further, I am uncomfortable with the mixture of two Weibulls starting with the same initial mean values. Shouldn’t they be distinct? However, while optimized values are dependent on the initial values, the resulting <span class="math inline">\(p\)</span>-values were nearly identical no matter which of the two “modes” of the distribution were found. Thus, while the optimal mixing parameters may alternate between two points based on intial values, the resulting <span class="math inline">\(p\)</span>-values remain unchanged.</li>
</ol>
<hr>
<p></p>
</div>
</div>
<div id="website" class="section level1">
<h1 class="hasAnchor">
<a href="#website" class="anchor"></a>Website</h1>
<p>Please see the “Articles” page of <a href="https://gabrielodom.github.io/pathwayPCA/" class="uri">https://gabrielodom.github.io/pathwayPCA/</a> for our hosted vignettes. Update the design of the website by editing the <code>_pkgdown.yaml</code> file. Update the content of the website pages by editing the vignettes and / or function documentation. When you update the website, run <code><a href="http://pkgdown.r-lib.org/reference/clean_site.html">pkgdown::clean_site()</a></code> then rebuild with <code><a href="http://pkgdown.r-lib.org/reference/build_site.html">pkgdown::build_site()</a></code>. In order to check the individual components (like, References, for instance), use <code><a href="http://pkgdown.r-lib.org/reference/build_reference.html">pkgdown::build_reference()</a></code> (or whichever section you need). For the available functions, see <a href="http://pkgdown.r-lib.org/reference/index.html" class="uri">http://pkgdown.r-lib.org/reference/index.html</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#user-supplied-inputs">User Supplied Inputs</a></li>
      <li><a href="#main-functions-outputs">Main Function(s) Outputs</a></li>
      <li><a href="#current-work">Current Work</a></li>
      <li>
<a href="#testing">Testing</a><ul class="nav nav-pills nav-stacked">
<li><a href="#installing-package-error">Installing Package Error</a></li>
      <li><a href="#data-format-and-structure">Data Format and Structure:</a></li>
      <li><a href="#functionality">Functionality:</a></li>
      <li><a href="#examples">Examples</a></li>
      <li><a href="#graphics">Graphics:</a></li>
      <li><a href="#computational-and-memory-issue">Computational and memory issue:</a></li>
      <li><a href="#report-of-errors">Report of errors:</a></li>
      <li><a href="#vignettes">Vignettes:</a></li>
      <li><a href="#other-thoughts">Other thoughts:</a></li>
      <li><a href="#testing-on-different-data-set">Testing on different data set:</a></li>
      </ul>
</li>
      <li><a href="#website">Website</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/gabrielodom">Gabriel Odom</a>, James Ban, <a href="http://biostat.med.miami.edu/people/primary-faculty/xi-steven-chen-ph.d">Steven Chen</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
