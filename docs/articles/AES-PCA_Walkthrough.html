<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AES-PCA Walkthrough with pathwayPCA • pathwayPCA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="AES-PCA Walkthrough with pathwayPCA">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pathwayPCA</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    User Guides
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AES-PCA_Walkthrough.html">AES-PCA Walkthrough with pathwayPCA</a>
    </li>
    <li>
      <a href="../articles/Create_Omics_Objects.html">Creating -Omics Data Objects</a>
    </li>
    <li>
      <a href="../articles/Importing_Data.html">Import and Tidy Data</a>
    </li>
    <li>
      <a href="../articles/Package_Dev_Notes.html">pathwayPCA Package Development Notes</a>
    </li>
    <li>
      <a href="../articles/Quickstart_Guide.html">Quickstart Guide to pathwayPCA</a>
    </li>
    <li>
      <a href="../articles/Supervised_PCA_Walkthrough.html">Supervised PCA Walkthrough with pathwayPCA</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Version Logs</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gabrielodom/pathwayPCA">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>AES-PCA Walkthrough with pathwayPCA</h1>
                        <h4 class="author">Gabriel Odom</h4>
            
            <h4 class="date">2018-04-13</h4>
      
      <small>Source: <a href="https://github.com/gabrielodom/pathwayPCA/blob/master/vignettes/AES-PCA_Walkthrough.Rmd"><code>vignettes/AES-PCA_Walkthrough.Rmd</code></a></small>
      <div class="hidden name"><code>AES-PCA_Walkthrough.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>This vignette is half of the third chapter in the “Pathway Significance Testing with <code>pathwayPCA</code>” workflow. This vignette builds on the material covered in the <a href="https://gabrielodom.github.io/pathwayPCA/articles/Importing_Data.html">“Import and Tidy Data”</a> and <a href="https://gabrielodom.github.io/pathwayPCA/articles/Create_Omics_Objects.html">“Creating -Omics Data Objects”</a> vignettes. This guide will outline the major steps needed analyze <code>Omics*</code>-class objects with pathway-level adaptive, elastic-net, sparse PCA (AES-PCA). We will consider three examples: survival, regression, and binary responses. The main goal of pathway AES-PCA is to discover potential relationships between pathways (bundles of genes) and a response. This package (in its current form) should not be used for prediction, or regressing on multiple variables, but should simply be used to screen or identify potential pathways for futher inspection.</p>
<div id="outline" class="section level3">
<h3 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h3>
<p>Before we move on, we will outline our steps. After reading this vignette, you should</p>
<ol style="list-style-type: decimal">
<li>Understand the basics of the AES-PCA pathway-significance testing approach.</li>
<li>Be able to apply AES-PCA to analyze survival (<code>OmicsSurv</code>), regression (<code>OmicsReg</code>), or classification (<code>OmicsCateg</code>) data containers.</li>
</ol>
</div>
<div id="load-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load Packages</h3>
<p>Before we begin, make sure you have the latest version of the package. In order to install a package from GitHub, you will need the <code>devtools::</code> package (<a href="https://github.com/r-lib/devtools" class="uri">https://github.com/r-lib/devtools</a>) and either <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a> (for Windows) or <a href="https://developer.apple.com/xcode/">Xcode</a> (for Mac). Then you can install the development version of the <a href="https://github.com/gabrielodom/pathwayPCA"><code>pathwayPCA</code> package</a> from <a href="https://github.com/">GitHub</a>:</p>
<pre><code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github("gabrielodom/pathwayPCA")</a></code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pathwayPCA)
<span class="kw">library</span>(parallel)</code></pre></div>
</div>
<div id="load-omics-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-omics-data" class="anchor"></a>Load <code>Omics*</code> Data</h3>
<p>Because you have already read through the <a href="https://gabrielodom.github.io/pathwayPCA/articles/Importing_Data.html">Import and Tidy Data</a> and <a href="https://gabrielodom.github.io/pathwayPCA/articles/Create_Omics_Objects.html">Creating -Omics Data Objects</a> vignettes, we will pick up with the <code>colon_OmicsSurv</code> object we created in the last vignette. For our pathway analysis to be meaningful, we need gene expression data (from a microarray or something similar), corresponding subject information (such as weight, type of cancer, or survival time and censoring indicator), and a gene set list. The <code>colon_OmicsSurv</code> data container has all of this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">colon_OmicsSurv
<span class="co">#&gt; Formal class 'OmicsSurv' [package "pathwayPCA"] with 4 slots</span>
<span class="co">#&gt;   ..@ eventTime    : num [1:250] 64.9 59.8 62.4 54.5 46.3 ...</span>
<span class="co">#&gt;   ..@ eventObserved: logi [1:250] FALSE FALSE FALSE FALSE TRUE FALSE ...</span>
<span class="co">#&gt;   ..@ assayData_df :Classes 'tbl_df', 'tbl' and 'data.frame':    250 obs. of  656 variables:</span>
<span class="co">#&gt;   ..@ pathwaySet   :List of 3</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:2] "pathwaySet" "list"</span></code></pre></div>
<p>Unlike our current implementation of <a href="https://gabrielodom.github.io/pathwayPCA/articles/Supervised_PCA_Walkthrough.html">Supervised PCA</a>, our current implementation of AES-PCA can handle some missingness in the response.</p>
<hr>
<p></p>
</div>
</div>
<div id="clean-up-the-pathway-list" class="section level1">
<h1 class="hasAnchor">
<a href="#clean-up-the-pathway-list" class="anchor"></a>Clean Up the Pathway List</h1>
<p>The analysis functions within the <code>pathwayPCA</code> package subset the feature data frame by the genes in each pathway. Therefore, if we have genes in the pathways that aren’t recorded in the data frame, then we will necessarily create missing (<code>NA</code>) predictors. To circumvent this issue, we should check if each gene in each pathway is recorded in the data frame, and remove the genes for which we have not recorded expression levels.</p>
<p>However, if we remove genes from the pathways which do not have recorded levels in the predictor data frame, we could theoretically remove all the genes from a pathway. Thus, we will also check to make sure that each pathway still has three or more genes present after we have removed the genes without corresponding expression levels. The <code><a href="../reference/expressedOmes.html">expressedOmes()</a></code> function performs these two actions simultaneously. This function takes in a valid <code>Omics*</code>-class object, removed the unexpressed genes from each pathway, subsequently trims the pathways that have fewer than three genes, and finally returns an object of the same <code>Omics*</code> class as the input. If there are any pathways that are removed due to this execution, the <code>pathways</code> list within the <code>pathwaySet</code> object within each <code>Omics*</code> object will have a character vector of the pathways removed stored as the <code>"missingPaths"</code> attribute. Access this attribute with the <code>attr()</code> function.</p>
<p>This function is called and executed within the <code><a href="../reference/superPCA_pVals.html">superPCA_pVals()</a></code> function.</p>
<div id="calculate-pathway-specific-model-p-values" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-pathway-specific-model-p-values" class="anchor"></a>Calculate Pathway-Specific Model <span class="math inline">\(p\)</span>-Values</h2>
<p>We now have a clean set of <code>Omics*</code> objects. We will</p>
<ol style="list-style-type: decimal">
<li>Extract the first principal components from each expressed pathway in the MS design matrix</li>
<li>Test their association with the response matrix or vector. This step uses a permutation test to estimate the pathway <span class="math inline">\(p\)</span>-values.</li>
<li>Adjust the pathway <span class="math inline">\(p\)</span>-values for False Discovery Rate (FDR)</li>
<li>Return a sorted data frame of the adjusted <span class="math inline">\(p\)</span>-values for each pathway</li>
</ol>
<p>The accuracy of the permuted <span class="math inline">\(p\)</span>-values will depend on how many permutations you call for. The default number in the <code><a href="../reference/AESPCA_pVals.html">AESPCA_pVals()</a></code> function is 1000. Be warned, however, that this may be too few permutations to create accurate seperation in pathway significance. You could increase the permutations to a larger value, should your computing resources allow for that. For even moderately-sized data sets (~2000 features) and 1000 pathways, this could take half an hour or more. About 20-25% of the computing costs will be extracting the AES-PCs from each pathway, and the remaining 75-80% of the cost will be the permutation test (for 1000 reps).</p>
<p>Another note: we use the FDR adjustments executed in the <code>mt.rawp2adjp</code> function from the Bioconductor package <a href="https://www.bioconductor.org/packages/3.7/bioc/manuals/multtest/man/multtest.pdf"><code>multtest</code></a>. We copied the code from this function into our package, and made some slight modifications. However, we do not depend on this package directly. We acknowledge their work in this area and express our gratitude.</p>
<div id="survival-response" class="section level3">
<h3 class="hasAnchor">
<a href="#survival-response" class="anchor"></a>Survival Response</h3>
<p>We will use all but two of our available cores, and use the Hochberg (1988) and Sidak Step-Down FDR-adjustment procedures.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
surv_pVals_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/AESPCA_pVals.html">AESPCA_pVals</a></span>(<span class="dt">object =</span> colon_OmicsSurv,
                              <span class="dt">numReps =</span> <span class="dv">1000</span>,
                              <span class="dt">parallel =</span> <span class="ot">TRUE</span>,
                              <span class="dt">numCores =</span> <span class="dv">2</span>,
                              <span class="dt">adjustpValues =</span> <span class="ot">TRUE</span>,
                              <span class="dt">adjustment =</span> <span class="kw">c</span>(<span class="st">"Hoch"</span>, <span class="st">"SidakSD"</span>))
<span class="co">#&gt; Of the 676 unique genes in the input pathway set, 9.0% were not expressed in</span>
<span class="co">#&gt;   the input data and were therefore removed.</span>
<span class="co">#&gt; After trimming unexpressed genes from the 15 supplied pathways, we removed 0</span>
<span class="co">#&gt;   pathway(s) because they contained 3 or fewer genes.</span>
<span class="co">#&gt; Of the 656 measured genes in the input data frame, 93.8% were included in at</span>
<span class="co">#&gt;   least one pathway after trimming.</span>
<span class="co">#&gt;  Part 1: Calculate Pathway AES-PCs</span>
<span class="co">#&gt; Initializing Cluster</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; Extracting Pathway PCs in Parallel</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Part 2: Calculate Permuted Pathway p-Values</span>
<span class="co">#&gt; Initializing Cluster</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; Extracting Pathway p-Values in Parallel</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Part 3: Adjusting p-Values and Sorting Pathway p-Value Data Frame</span>
<span class="co">#&gt; DONE</span>
<span class="kw">Sys.time</span>() <span class="op">-</span><span class="st"> </span>a
<span class="co">#&gt; Time difference of 29.51023 secs</span></code></pre></div>
</div>
<div id="regression-response" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-response" class="anchor"></a>Regression Response</h3>
<p>We will use the Holm (1979) and Benjamini and Hochberg (1995) FDR-adjustment procedures.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
reg_pVals_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/AESPCA_pVals.html">AESPCA_pVals</a></span>(<span class="dt">object =</span> colon_OmicsReg,
                             <span class="dt">numReps =</span> <span class="dv">1000</span>,
                             <span class="dt">parallel =</span> <span class="ot">TRUE</span>,
                             <span class="dt">numCores =</span> <span class="dv">2</span>,
                             <span class="dt">adjustpValues =</span> <span class="ot">TRUE</span>,
                             <span class="dt">adjustment =</span> <span class="kw">c</span>(<span class="st">"Holm"</span>, <span class="st">"BH"</span>))
<span class="co">#&gt; Of the 676 unique genes in the input pathway set, 9.0% were not expressed in</span>
<span class="co">#&gt;   the input data and were therefore removed.</span>
<span class="co">#&gt; After trimming unexpressed genes from the 15 supplied pathways, we removed 0</span>
<span class="co">#&gt;   pathway(s) because they contained 3 or fewer genes.</span>
<span class="co">#&gt; Of the 656 measured genes in the input data frame, 93.8% were included in at</span>
<span class="co">#&gt;   least one pathway after trimming.</span>
<span class="co">#&gt;  Part 1: Calculate Pathway AES-PCs</span>
<span class="co">#&gt; Initializing Cluster</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; Extracting Pathway PCs in Parallel</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Part 2: Calculate Permuted Pathway p-Values</span>
<span class="co">#&gt; Initializing Cluster</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; Extracting Pathway p-Values in Parallel</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Part 3: Adjusting p-Values and Sorting Pathway p-Value Data Frame</span>
<span class="co">#&gt; DONE</span>
<span class="kw">Sys.time</span>() <span class="op">-</span><span class="st"> </span>b
<span class="co">#&gt; Time difference of 15.96279 secs</span></code></pre></div>
</div>
<div id="binary-classification-response" class="section level3">
<h3 class="hasAnchor">
<a href="#binary-classification-response" class="anchor"></a>Binary Classification Response</h3>
<p>We will use the Sidak Single-Step and Benjamini and Yekutieli (2001) FDR-adjustment procedures.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
categ_pVals_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/AESPCA_pVals.html">AESPCA_pVals</a></span>(<span class="dt">object =</span> colon_OmicsCateg,
                               <span class="dt">numReps =</span> <span class="dv">1000</span>,
                               <span class="dt">parallel =</span> <span class="ot">TRUE</span>,
                               <span class="dt">numCores =</span> <span class="dv">2</span>,
                               <span class="dt">adjustpValues =</span> <span class="ot">TRUE</span>,
                               <span class="dt">adjustment =</span> <span class="kw">c</span>(<span class="st">"SidakSS"</span>, <span class="st">"BY"</span>))
<span class="co">#&gt; Of the 676 unique genes in the input pathway set, 9.0% were not expressed in</span>
<span class="co">#&gt;   the input data and were therefore removed.</span>
<span class="co">#&gt; After trimming unexpressed genes from the 15 supplied pathways, we removed 0</span>
<span class="co">#&gt;   pathway(s) because they contained 3 or fewer genes.</span>
<span class="co">#&gt; Of the 656 measured genes in the input data frame, 93.8% were included in at</span>
<span class="co">#&gt;   least one pathway after trimming.</span>
<span class="co">#&gt;  Part 1: Calculate Pathway AES-PCs</span>
<span class="co">#&gt; Initializing Cluster</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; Extracting Pathway PCs in Parallel</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Part 2: Calculate Permuted Pathway p-Values</span>
<span class="co">#&gt; Initializing Cluster</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; Extracting Pathway p-Values in Parallel</span>
<span class="co">#&gt; DONE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Part 3: Adjusting p-Values and Sorting Pathway p-Value Data Frame</span>
<span class="co">#&gt; DONE</span>
<span class="kw">Sys.time</span>() <span class="op">-</span><span class="st"> </span>d
<span class="co">#&gt; Time difference of 25.74354 secs</span></code></pre></div>
</div>
</div>
<div id="subset-the-top-pathways" class="section level2">
<h2 class="hasAnchor">
<a href="#subset-the-top-pathways" class="anchor"></a>Subset the Top Pathways</h2>
<p>Now that we have the pathway-specific <span class="math inline">\(p\)</span>-values, we can inspect the top pathways by significance. We will first subset the data frame returned by the <code><a href="../reference/superPCA_pVals.html">superPCA_pVals()</a></code> function, then plot the most significant <span class="math inline">\(p\)</span>-values using the <code>ggplot2::</code> package. For graphics, we will need two new packages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="co">#&gt; -- Attaching packages ------------------------------------------------------------------------------------------------------------------- tidyverse 1.2.1 --</span>
<span class="co">#&gt; v ggplot2 2.2.1     v purrr   0.2.4</span>
<span class="co">#&gt; v tibble  1.4.2     v dplyr   0.7.4</span>
<span class="co">#&gt; v tidyr   0.8.0     v stringr 1.3.0</span>
<span class="co">#&gt; v readr   1.1.1     v forcats 0.3.0</span>
<span class="co">#&gt; -- Conflicts ---------------------------------------------------------------------------------------------------------------------- tidyverse_conflicts() --</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="kw">library</span>(reshape2)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'reshape2'</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     smiths</span></code></pre></div>
<p>For each pathway <span class="math inline">\(p\)</span>-value data frame, we will select the top pathways, and transform the data for better graphics. Then, we will plot the pathway <span class="math inline">\(p\)</span>-values for the most significant pathways as a horizontal bar chart. The thick vertical black line is at <span class="math inline">\(p = 0.05\)</span>, and the thin vertical black line is at <span class="math inline">\(p = 0.10\)</span>.</p>
<div id="significant-survival-pathways" class="section level3">
<h3 class="hasAnchor">
<a href="#significant-survival-pathways" class="anchor"></a>Significant Survival Pathways</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Melt the data</span>
surv_melt_df &lt;-<span class="st"> </span>surv_pVals_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>terms, <span class="op">-</span><span class="st"> </span>setsize, <span class="op">-</span>trim_size) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">"pathways"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">score =</span> <span class="op">-</span><span class="kw">log</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pathways =</span> <span class="kw">factor</span>(pathways,
                           <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">unique</span>(pathways)),
                           <span class="dt">ordered =</span> <span class="ot">TRUE</span>))

<span class="co"># Plot Melted Data</span>
<span class="kw">ggplot</span>(surv_melt_df) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> pathways, <span class="dt">y =</span> score, <span class="dt">fill =</span> variable) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">"FDR Adjustment"</span>,
                      <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">"rawp"</span>, <span class="st">"Hochberg"</span>, <span class="st">"SidakSD"</span>),
                      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"None"</span>, <span class="st">"Hochberg"</span>, <span class="st">"Sidak SD"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Colon Pathways by Survival Response"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Pathways"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Log p-Value"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="op">-</span><span class="kw">log</span>(<span class="fl">0.05</span>), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="op">-</span><span class="kw">log</span>(<span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="AES-PCA_Walkthrough_files/figure-html/surv_pval_plot-1.png" width="100%" height="60%"></p>
</div>
<div id="significant-regression-pathways" class="section level3">
<h3 class="hasAnchor">
<a href="#significant-regression-pathways" class="anchor"></a>Significant Regression Pathways</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Melt the data</span>
reg_melt_df &lt;-<span class="st"> </span>reg_pVals_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>terms, <span class="op">-</span><span class="st"> </span>setsize, <span class="op">-</span>trim_size) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">"pathways"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">score =</span> <span class="op">-</span><span class="kw">log</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pathways =</span> <span class="kw">factor</span>(pathways,
                           <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">unique</span>(pathways)),
                           <span class="dt">ordered =</span> <span class="ot">TRUE</span>))

<span class="co"># Plot Melted Data</span>
<span class="kw">ggplot</span>(reg_melt_df) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> pathways, <span class="dt">y =</span> score, <span class="dt">fill =</span> variable) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">"FDR Adjustment"</span>,
                      <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">"rawp"</span>, <span class="st">"Holm"</span>, <span class="st">"BH"</span>),
                      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"None"</span>, <span class="st">"Holm"</span>, <span class="st">"BH"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Colon Pathways by Regression Response"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Pathways"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Log p-Value"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="op">-</span><span class="kw">log</span>(<span class="fl">0.05</span>), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="op">-</span><span class="kw">log</span>(<span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="AES-PCA_Walkthrough_files/figure-html/reg_pval_plot-1.png" width="100%" height="60%"></p>
</div>
<div id="significant-binary-classification-pathways" class="section level3">
<h3 class="hasAnchor">
<a href="#significant-binary-classification-pathways" class="anchor"></a>Significant Binary Classification Pathways</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Melt the data</span>
categ_melt_df &lt;-<span class="st"> </span>categ_pVals_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>terms, <span class="op">-</span><span class="st"> </span>setsize, <span class="op">-</span>trim_size) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">"pathways"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">score =</span> <span class="op">-</span><span class="kw">log</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pathways =</span> <span class="kw">factor</span>(pathways,
                           <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">unique</span>(pathways)),
                           <span class="dt">ordered =</span> <span class="ot">TRUE</span>))

<span class="co"># Plot Melted Data</span>
<span class="kw">ggplot</span>(categ_melt_df) <span class="op">+</span>
<span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> pathways, <span class="dt">y =</span> score, <span class="dt">fill =</span> variable) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name =</span> <span class="st">"FDR Adjustment"</span>,
                      <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">"rawp"</span>, <span class="st">"SidakSS"</span>, <span class="st">"BY"</span>),
                      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"None"</span>, <span class="st">"Sidak SS"</span>, <span class="st">"BY"</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Colon Pathways by Binary Classification Response"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Pathways"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Log p-Value"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="op">-</span><span class="kw">log</span>(<span class="fl">0.05</span>), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="op">-</span><span class="kw">log</span>(<span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="AES-PCA_Walkthrough_files/figure-html/categ_pval_plot-1.png" width="100%" height="60%"></p>
</div>
</div>
<div id="rank-significant-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#rank-significant-genes" class="anchor"></a>Rank Significant Genes</h2>
<p>Given that we have so far only considered collections of genes, rather than the genes themselves, we can inspect which genes show up the most often in the top-ranked pathways. Our method is to build a matrix of pathways and their genes: each column is a pathway, and each row is a gene. The <span class="math inline">\(i, j\)</span> entry of this matrix is a 1 if gene <span class="math inline">\(i\)</span> is contained in pathway <span class="math inline">\(j\)</span> (after trimming to the genes measured in the supplied assay). Now consider the adjusted <span class="math inline">\(p\)</span>-values of pathway <span class="math inline">\(j\)</span>, <span class="math inline">\(p_{1j}, p_{2j}, \ldots, p_{Aj}\)</span>, where <span class="math inline">\(a \in \{1, 2, \ldots A\}\)</span> are the FDR adjustment methods; we define the pathway score for this pathway as <span class="math display">\[
S_j := - \frac{1}{A}\sum\limits_{a = 1}^A \log(p_{aj}).
\]</span> We then mulitply each of the columns in the matrix by its respective score.</p>
<p>Now consider the rows of this matrix. Each row is a gene, and the <span class="math inline">\(j^{th}\)</span> entry in the row is equal to <span class="math inline">\(S_j\)</span>, if the gene is included in pathway <span class="math inline">\(j\)</span>, and 0 otherwise. These genes can be compared by the raw row sum of scores, or by the average of the non-zero scores. The <code><a href="../reference/topGenes.html">topGenes()</a></code> function returns the top 5% of both. As we can see, most of the genes included in the <code>summedRank</code> vector are the in the list of “usual suspects” for colon cancer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/topGenes.html">topGenes</a></span>(<span class="dt">object =</span> colon_OmicsSurv, <span class="dt">pVals_df =</span> surv_pVals_df, <span class="dt">percentile =</span> <span class="fl">0.02</span>)
<span class="co">#&gt; $summedRank</span>
<span class="co">#&gt;   PIK3CA   PIK3R1    MAPK1   MAP2K1     NRAS     GRB2    MAPK3     HRAS </span>
<span class="co">#&gt; 21.86657 21.86657 18.21665 18.17706 18.17706 18.17706 18.17706 18.17706 </span>
<span class="co">#&gt;     KRAS     SHC1      CRK   PIK3CB   PIK3R2 </span>
<span class="co">#&gt; 18.17706 18.13746 18.13746 17.60454 17.60454 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $averagedRank</span>
<span class="co">#&gt;   TCIRG1 ATP6V1G3 ATP6V0A2 ATP6V0D2 ATP6V1C2 ATP6V0A4  ATP6V1D  ATP6V1H </span>
<span class="co">#&gt; 8.880363 8.880363 8.880363 8.880363 8.880363 8.880363 8.880363 8.880363 </span>
<span class="co">#&gt;  ATP6V1A ATP6V1B1 ATP6V1B2  ATP6V0C ATP6V1C1 ATP6V1E1  ATP6V0B ATP6V1G2 </span>
<span class="co">#&gt; 8.880363 8.880363 8.880363 8.880363 8.880363 8.880363 8.880363 8.880363 </span>
<span class="co">#&gt; ATP6V0E1 ATP6V1E2 ATP6V0D1  ATP6V1F ATP6V1G1 </span>
<span class="co">#&gt; 8.880363 8.880363 8.880363 8.880363 8.880363</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li>
<a href="#clean-up-the-pathway-list">Clean Up the Pathway List</a><ul class="nav nav-pills nav-stacked">
<li><a href="#calculate-pathway-specific-model-p-values">Calculate Pathway-Specific Model <span class="math inline">\(p\)</span>-Values</a></li>
      <li><a href="#subset-the-top-pathways">Subset the Top Pathways</a></li>
      <li><a href="#rank-significant-genes">Rank Significant Genes</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/gabrielodom">Gabriel Odom</a>, James Ban, <a href="http://biostat.med.miami.edu/people/primary-faculty/xi-steven-chen-ph.d">Steven Chen</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
