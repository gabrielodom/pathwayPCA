---
title: "Chapter 1 - Quickstart Guide"
author: "Gabriel Odom"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 2
    number_sections: true
  word_document:
    toc: true
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Quickstart Guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE,
                      cache = FALSE,
                      comment = "#>")
```


# Overview
This guide will serve as a brief introduction to pathway significance testing with the `pathwayPCA` package. We will discuss four steps. For detailed discussion of these four steps, see the appropriate vignettes. This vignette is the introduction and overview chapter in the "Pathway Significance Testing with `pathwayPCA`" workflow. 

0. Download Packages
1. Import Data ([*vignette*](https://gabrielodom.github.io/pathwayPCA/articles/C2-Importing_Data.html))
2. Create `Omics` Data Object ([*vignette*](https://gabrielodom.github.io/pathwayPCA/articles/C3-Create_Omics_Objects.html))
3. Test Pathway Significance ([*vignette*](https://gabrielodom.github.io/pathwayPCA/articles/C4-Methods_Walkthrough.html))
4. Inspect Results

Before we get started, you need the `pathwayPCA` package to run your analysis. Because we are currently in the development phase for Bioconductor, you can install this package from GitHub. Also, if you want your analysis to be performed with parallel computing, you will need a package to help you. We recommend the `parallel` package. We also recommend the `tidyverse` package to help you run some of the examples in these vignettes (while the `tidyverse` package suite is required for many of the examples in the vignettes, it is not required for any of the functions in this package). 
```
devtools::install_github("gabrielodom/pathwayPCA")
```
```{r}
library(pathwayPCA)
library(tidyverse)
library(parallel)
```


*******************************************************************************

</br>


# Import Data
This section is a quick overview of the material covered in the [Import and Tidy Data](https://gabrielodom.github.io/pathwayPCA/articles/C2-Importing_Data.html) vignette. We will cover three data import steps.


## Import `.gmt` Files
GMT files are one form of gene set file officially recognized by the Gene Set Enrichment Analysis committee of the Broad Institute. These Molecular Signatures Database (MSigDB) GMT files can be downloaded from the [MSigDB Collections](http://software.broadinstitute.org/gsea/msigdb/collections.jsp) page. Use the `read_gmt` function to import a `.gmt` file into R.
```{r read_example_gmt, eval = FALSE}
gene_set_ls <- read_gmt("path_to_your_directory/your_file_name.gmt")
gene_set_ls
```
```{r read_real_gmt, echo = FALSE}
gene_set_ls <- read_gmt("../inst/extdata/c2.cp.v6.0.symbols.gmt")
gene_set_ls
```

The imported `.gmt` file is stored as a `pathwaySet` list object. This list contains the names of the pathways (`TERMS`), the hyperlink to the pathway description card on the GSEA website (`GSEA_link`), and a list of all the pathway sets (`pathways`).


## Import and Tidy Assay Data
We assume that the assay data (be it genomic, proteomic, metabolomic, lipidomic, or transcriptomic data) is either in an Excel file or flat text file. For example, your data may look like this:

![](example_assay_data.PNG)

In this data set, the columns are individual samples, patients, tumors, cell lines, etc. The rows are the -Omic expression measures. Use the `read_csv` function from the `readr` package to import `.csv` files and the like. If your data has samples in the columns and -omic feature measurements in the rows, you'll need to "tidy" the imported assay with the `transpose_assay` function.
```{r read_example_assay, eval = FALSE}
assay_df <- read_csv("path_to_your_directory/your_assay.csv")
assayT_df <- transpose_assay(assay_df)
assayT_df
```
```{r read_real_assay, echo = FALSE}
# Travis requires relative paths
assay_df <- read_csv("../inst/extdata/ex_assay_subset.csv")
assayT_df <- transpose_assay(assay_df)
assayT_df
```


## Import Patient Info
Use the `read_csv` function to import the patient data.
```{r read_example_pinfo, eval = FALSE}
pInfo_df <- read_csv("path_to_your_directory/your_subject_info.csv")
pInfo_df
```
```{r read_real_pinfo, echo = FALSE}
pInfo_df <- read_csv("../inst/extdata/ex_pInfo_subset.csv")
pInfo_df
```


## Match the Patient and Assay Data
Now that you have the measurement data in tidy form (`assayT_df`) and the patient response data (`pInfo_df`), you can use the `inner_join` function from the `dplyr` package to match the assay measurements to patient information by subject identifier.
```{r innerJoin}
(joinedExperiment_df <- inner_join(pInfo_df, assayT_df, by = "Sample"))
```


*******************************************************************************

</br>


# Create an `Omics` Data Object
This section is a quick overview of the material covered in the [Create an `Omics*` Data Container](https://gabrielodom.github.io/pathwayPCA/articles/C3-Create_Omics_Objects.html) vignette.

## Create an Object
Using the data you just imported, create a data container specific to survival, regression, or categorical responses. There are three classes of `Omics*` objects to match the three types of response. Each class contains a tidy assay and `pathwaySet` gene set list, but the classes differ in the type of response information they can hold. The classes, and their responses, are

1. `OmicsSurv`---a data container for survival information, which includes event time (the time of last follow-up with a subject) and event indicator (did the subject die, or was the observation right-censored?).
2. `OmicsReg`---a data container for continuous responses (usually a linear regression response).
3. `OmicsCateg`---a data container for categorical responses, the dependent variable of a generalized linear model. Currently, we only support binary classification (through logistic regression).

We will create an `OmicsSurv` object to hold our assay, pathway set list, and survival response.
```{r create_OmicsSurv_object}
colon_OmicsSurv <- create_Omics(assayData_df = colonSurv_df[, -(1:2)],
                                pathwaySet_ls = colon_pathwaySet,
                                response = colonSurv_df[, 1:2],
                                respType = "surv")
```

## Inspect the Object Contents
Print the object to the screen to see a summary of the data contained therein.
```{r view_Omics}
colon_OmicsSurv
```

## Modify Object Contents
Use accessor functions to extract, edit, or replace data contained in the object. The accessor functions are listed in more detail in the [Table of Accessors](https://gabrielodom.github.io/pathwayPCA/articles/C3-Create_Omics_Objects.html#table-of-accessors) subsection of Chapter 3.

### Assay
```{r accessor1}
getAssay(colon_OmicsSurv)
```

### Pathway Set List
```{r accessor2}
getPathwaySet(colon_OmicsSurv)
```

### Event Time
```{r accessor3}
head(getEventTime(colon_OmicsSurv), 10)
```

### Event Indicator
```{r accessor4}
head(getEvent(colon_OmicsSurv), 10)
```

*******************************************************************************

</br>


# Test Pathways for Significance
This section is a quick overview of the material covered in the "AES-PCA" and "Supervised PCA" sections of the [Test Pathway Significance](https://gabrielodom.github.io/pathwayPCA/articles/C4-Methods_Walkthrough.html) vignette.


## AES-PCA
Perform AES-PCA on the object with the `AESPCA_pVals` function.

## Supervised PCA
Perform Supervised PCA on the object with the `superPCA_pVals` function.

*******************************************************************************

</br>


# Inspect Results
This section is a quick overview of the material covered in the "Analyze the Results" section of the [Test Pathway Significance](https://gabrielodom.github.io/pathwayPCA/articles/C4-Methods_Walkthrough.html) vignette.

## Graph of Top Pathways
Use `ggplot2` to create summary graphics of the analysis results.

## Extract Genes from the Top Pathways
Use the `topGenes` function to "score" the genes contained in the top significant pathways.
